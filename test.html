<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chat Style API Tester</title>

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

  <style>
    body {
      background: #f0f2f5;
      font-family: "Inter", Arial, sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
    }

    .chat-container {
      width: 100%;
      max-width: 800px;
      height: 90vh;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-header {
      padding: 18px;
      font-size: 22px;
      font-weight: bold;
      background: #0b5ed7;
      color: white;
      text-align: center;
    }

    .chat-box {
      flex-grow: 1;
      overflow-y: auto;
      padding: 20px;
      background: #eef1f5;
    }

    .bubble {
      padding: 14px 18px;
      margin-bottom: 14px;
      max-width: 75%;
      border-radius: 16px;
      line-height: 1.5;
      font-size: 16px;
      white-space: pre-wrap; /* KEY FIX */
    }

    .user-bubble {
      background: #0b5ed7;
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 2px;
    }

    .bot-bubble {
      background: #ffffff;
      color: #333;
      margin-right: auto;
      border-bottom-left-radius: 2px;
      border: 1px solid #ddd;
    }

    .chat-input-area {
      padding: 16px;
      background: #fff;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    textarea {
      resize: none;
    }
  </style>
</head>

<body>

<div class="chat-container">

  <div class="chat-header">
    AI Reply Chat
  </div>

  <div id="chatBox" class="chat-box"></div>

  <div class="chat-input-area">
  <textarea id="reply" class="form-control" rows="2">I am stressed about exams</textarea>

  <select id="tone" class="form-select" style="max-width: 150px;">
    <option value="mentor">Mentor</option>
    <option value="witty">Witty</option>
    <option value="therapist">Therapist</option>
  </select>

  <button id="sendBtn" class="btn btn-primary" onclick="sendMessage()">Send</button>
</div>



</div>

<script>
function addMessageBubble(text, isUser) {
  const box = document.getElementById("chatBox");
  const bubble = document.createElement("div");

  bubble.classList.add("bubble", isUser ? "user-bubble" : "bot-bubble");

  // FIX: Replace \n with real newlines
  bubble.textContent = text.replace(/\\n/g, "\n");

  box.appendChild(bubble);
  box.scrollTop = box.scrollHeight;
}

function sendMessage() {
  const reply = document.getElementById("reply").value.trim();
  const tone  = document.getElementById("tone").value;

  if (!reply) return;

  addMessageBubble(reply, true);
  document.getElementById("reply").value = "";

  // Loading bubble
  const loadingBubble = document.createElement("div");
  loadingBubble.classList.add("bubble", "bot-bubble");
  loadingBubble.textContent = "Typing...";
  loadingBubble.id = "loadingBubble";
  document.getElementById("chatBox").appendChild(loadingBubble);

  fetch("https://gupp-shupp-assignment.onrender.com/reply", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ reply: reply, tone: tone })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("loadingBubble").remove();

    // Use formatted output
    addMessageBubble(data.rewritten, false);
  })
  .catch(err => {
    document.getElementById("loadingBubble").remove();
    addMessageBubble("Error: " + err, false);
  });
}

// --------------------------------------------------------
// DEFAULT PLACEHOLDER MESSAGE IN CHAT WINDOW
// --------------------------------------------------------

</script>

</body>
</html>
